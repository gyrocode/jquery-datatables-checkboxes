/*
   Copyright (c) Gyrocode
 @license     MIT License

 @contribute Nikitul (https://github.com/nikitul/)
 Checkboxes 1.2.11
  Copyright (c) Gyrocode (www.gyrocode.com)
  License: MIT License
*/
(function(f){"function"===typeof define&&define.amd?define(["jquery","datatables.net"],function(l){return f(l,window,document)}):"object"===typeof exports?module.exports=function(l,m){l||(l=window);m&&m.fn.dataTable||(m=require("datatables.net")(l,m).$);return f(m,l,l.document)}:f(jQuery,window,document)})(function(f,l,m){var p=f.fn.dataTable,n=function(a){if(!p.versionCheck||!p.versionCheck("1.10.8"))throw"DataTables Checkboxes requires DataTables 1.10.8 or newer";this.s={dt:new p.Api(a),columns:[],
data:[],dataDisabled:[],ignoreSelect:!1};this.s.ctx=this.s.dt.settings()[0];this.s.ctx.checkboxes||(a.checkboxes=this,this._constructor())};n.prototype={_constructor:function(){for(var a=this,c=a.s.dt,b=a.s.ctx,d=!1,g=!1,e=0;e<b.aoColumns.length;e++)if(b.aoColumns[e].checkboxes){var h=f(c.column(e).header());d=!0;f.isPlainObject(b.aoColumns[e].checkboxes)||(b.aoColumns[e].checkboxes={});b.aoColumns[e].checkboxes=f.extend({},n.defaults,b.aoColumns[e].checkboxes);var k={orderable:!1};k.className=""===
b.aoColumns[e].sClass?"dt-checkboxes-cell":b.aoColumns[e].sClass+" dt-checkboxes-cell";null===b.aoColumns[e].sWidthOrig&&(k.width="1%");null===b.aoColumns[e].mRender&&(k.render=function(){return'<input type="checkbox" class="dt-checkboxes">'});p.ext.internal._fnColumnOptions(b,e,k);h.removeClass("sorting");h.off(".dt");if(null===b.sAjaxSource){var q=c.cells("tr",e);q.invalidate("data");f(q.nodes()).addClass(k.className)}a.s.data[e]={};a.s.dataDisabled[e]={};a.s.columns.push(e);b.aoColumns[e].checkboxes.selectRow&&
(b._select?g=!0:b.aoColumns[e].checkboxes.selectRow=!1);b.aoColumns[e].checkboxes.selectAll&&(h.data("html",h.html()),null!==b.aoColumns[e].checkboxes.selectAllRender&&(k="",f.isFunction(b.aoColumns[e].checkboxes.selectAllRender)?k=b.aoColumns[e].checkboxes.selectAllRender():"string"===typeof b.aoColumns[e].checkboxes.selectAllRender&&(k=b.aoColumns[e].checkboxes.selectAllRender),h.html(k).addClass("dt-checkboxes-select-all").attr("data-col",e)))}if(d){a.loadState();d=f(c.table().node());e=f(c.table().body());
h=f(c.table().container());g&&(d.addClass("dt-checkboxes-select"),d.on("user-select.dt.dtCheckboxes",function(b,c,d,e,g){a.onDataTablesUserSelect(b,c,d,e,g)}),d.on("select.dt.dtCheckboxes deselect.dt.dtCheckboxes",function(b,c,d,e){a.onDataTablesSelectDeselect(b,d,e)}),c.select.info(!1),d.on("draw.dt.dtCheckboxes select.dt.dtCheckboxes deselect.dt.dtCheckboxes",function(){a.showInfoSelected()}));d.on("draw.dt.dtCheckboxes",function(b){a.onDataTablesDraw(b)});e.on("click.dtCheckboxes","input.dt-checkboxes",
function(b){a.onClick(b,this)});h.on("click.dtCheckboxes",'thead th.dt-checkboxes-select-all input[type="checkbox"]',function(b){a.onClickSelectAll(b,this)});h.on("click.dtCheckboxes","thead th.dt-checkboxes-select-all",function(){f('input[type="checkbox"]',this).not(":disabled").trigger("click")});if(!g)h.on("click.dtCheckboxes","tbody td.dt-checkboxes-cell",function(){f('input[type="checkbox"]',this).not(":disabled").trigger("click")});h.on("click.dtCheckboxes","thead th.dt-checkboxes-select-all label, tbody td.dt-checkboxes-cell label",
function(a){a.preventDefault()});f(m).on("click.dtCheckboxes",'.fixedHeader-floating thead th.dt-checkboxes-select-all input[type="checkbox"]',function(c){if(b._fixedHeader&&b._fixedHeader.dom.header.floating)a.onClickSelectAll(c,this)});f(m).on("click.dtCheckboxes",".fixedHeader-floating thead th.dt-checkboxes-select-all",function(){b._fixedHeader&&b._fixedHeader.dom.header.floating&&f('input[type="checkbox"]',this).trigger("click")});d.on("init.dt.dtCheckboxes",function(){a.onDataTablesInit()});
d.on("stateSaveParams.dt.dtCheckboxes",function(b,c,d){a.onDataTablesStateSave(b,c,d)});d.one("destroy.dt.dtCheckboxes",function(b,c){a.onDataTablesDestroy(b,c)})}},onDataTablesInit:function(){var a=this,c=a.s.dt,b=a.s.ctx;b.oFeatures.bServerSide||(b.oFeatures.bStateSave&&a.updateState(),f(c.table().node()).on("xhr.dt.dtCheckboxes",function(b,c,e,f){a.onDataTablesXhr(b.settings,e,f)}))},onDataTablesUserSelect:function(a,c,b,d){b=this.s.ctx;var g=d.index().row;d=this.getSelectRowColIndex();c=b.rowId?
c.cell({row:g,column:d}).row().id():c.cell({row:g,column:d}).data();this.isCellSelectable(d,c)||a.preventDefault()},onDataTablesSelectDeselect:function(a,c,b){var d=this.s.dt;this.s.ignoreSelect||"row"!==c||(c=this.getSelectRowColIndex(),null!==c&&(b=d.cells(b,c),this.updateData(b,c,"select"===a.type?!0:!1),this.updateCheckbox(b,c,"select"===a.type?!0:!1),this.updateSelectAll(c)))},onDataTablesStateSave:function(a,c,b){var d=this,g=d.s.ctx;b.checkboxes=[];f.each(d.s.columns,function(a,c){g.aoColumns[c].checkboxes.stateSave&&
(b.checkboxes[c]=d.s.data[c])})},onDataTablesDestroy:function(){var a=this.s.dt,c=f(a.table().node()),b=f(a.table().body());a=f(a.table().container());f(m).off("click.dtCheckboxes");a.off(".dtCheckboxes");b.off(".dtCheckboxes");c.off(".dtCheckboxes");this.s.data={};this.s.dataDisabled={};f(".dt-checkboxes-select-all",c).each(function(a,b){f(b).html(f(b).data("html")).removeClass("dt-checkboxes-select-all")})},onDataTablesDraw:function(){var a=this.s.ctx;(a.oFeatures.bServerSide||a.oFeatures.bDeferRender)&&
this.updateStateCheckboxes({page:"current",search:"none"});f.each(this.s.columns,function(c,b){a._oFixedColumns?setTimeout(function(){a.checkboxes.updateSelectAll(b)},0):a.checkboxes.updateSelectAll(b)})},onDataTablesXhr:function(){var a=this,c=a.s.ctx,b=f(a.s.dt.table().node());f.each(a.s.columns,function(b,c){a.s.data[c]={};a.s.dataDisabled[c]={}});c.oFeatures.bStateSave&&(a.loadState(),b.one("draw.dt.dtCheckboxes",function(){a.updateState()}))},updateData:function(a,c,b){var d=this.s.dt,f=this.s.ctx;
if(f.aoColumns[c].checkboxes){var e=f.rowId?d.rows(a.nodes()).ids():a.data(),h=a.data(),k=d.rows(a.nodes()).data();e.each(function(a,d){b?f.checkboxes.s.data[c][a]={cell:h[d],row:k[d]}:delete f.checkboxes.s.data[c][a]});f.oFeatures.bStateSave&&f.aoColumns[c].checkboxes.stateSave&&d.state.save()}},updateSelect:function(a,c){var b=this.s.dt;this.s.ctx._select&&(this.s.ignoreSelect=!0,c?b.rows(a).select():b.rows(a).deselect(),this.s.ignoreSelect=!1)},updateCheckbox:function(a,c,b){var d=this.s.ctx;a=
a.nodes();a.length&&(f("input.dt-checkboxes",a).not(":disabled").prop("checked",b),f.isFunction(d.aoColumns[c].checkboxes.selectCallback)&&d.aoColumns[c].checkboxes.selectCallback(a,b))},updateState:function(){var a=this;a.updateStateCheckboxes({page:"all",search:"none"});f.each(a.s.columns,function(c,b){a.updateSelectAll(b)})},updateStateCheckboxes:function(a){var c=this,b=c.s.ctx;c.s.dt.cells("tr",c.s.columns,a).every(function(a,g){var d=b.rowId?this.row(a).id():this.data(),h=c.isCellSelectable(g,
d);b.checkboxes.s.data[g].hasOwnProperty(d)&&(c.updateCheckbox(this,g,!0),b.aoColumns[g].checkboxes.selectRow&&h&&c.updateSelect(a,!0));h||f("input.dt-checkboxes",this.node()).prop("disabled",!0)})},onClick:function(a,c){var b=this,d=b.s.dt,g=b.s.ctx,e=f(c).closest("td"),h=d.cell(e),k=h.index().column;g.aoColumns[k].checkboxes.selectRow?setTimeout(function(){var a=g.rowId?h.row().id():h.data();a=b.s.data[k].hasOwnProperty(a);a!==c.checked&&(b.updateCheckbox(h,k,a),b.updateSelectAll(k))},0):(h.checkboxes.select(c.checked),
a.stopPropagation())},onClickSelectAll:function(a,c){var b=this.s.dt,d=this.s.ctx;var g=f(c).closest("th");g=g.parents(".DTFC_Cloned").length?f(g).data("col"):b.column(g).index();f(c).data("is-changed",!0);b.column(g,{page:d.aoColumns[g].checkboxes&&d.aoColumns[g].checkboxes.selectAllPages?"all":"current",search:"applied"}).checkboxes.select(c.checked);a.stopPropagation()},loadState:function(){var a=this,c=a.s.dt,b=a.s.ctx;if(b.oFeatures.bStateSave){var d=c.state.loaded();f.each(a.s.columns,function(c,
e){d&&d.checkboxes&&d.checkboxes.hasOwnProperty(e)&&b.aoColumns[e].checkboxes.stateSave&&(a.s.data[e]=d.checkboxes[e])})}},updateSelectAll:function(a){var c=this,b=c.s.dt,d=c.s.ctx;if(d.aoColumns[a].checkboxes&&d.aoColumns[a].checkboxes.selectAll){var g=b.cells("tr",a,{page:d.aoColumns[a].checkboxes.selectAllPages?"all":"current",search:"applied"}),e=b.table().container();e=f('.dt-checkboxes-select-all[data-col="'+a+'"] input[type="checkbox"]',e);var h=0,k=0;b=d.rowId?b.rows(g.nodes()).ids():g.data();
f.each(b,function(b,d){c.isCellSelectable(a,d)?c.s.data[a].hasOwnProperty(d)&&h++:k++});d._fixedHeader&&d._fixedHeader.dom.header.floating&&(e=f('.fixedHeader-floating .dt-checkboxes-select-all[data-col="'+a+'"] input[type="checkbox"]'));d._oFixedColumns&&!d._fixedHeader&&(a<d._oFixedColumns.s.iLeftColumns&&(e=f('.dt-checkboxes-select-all[data-col="'+a+'"] input[type="checkbox"]',d._oFixedColumns.dom.clone.left.header)),a>d._oFixedColumns.s.iTableColumns-d._oFixedColumns.s.iRightColumns-1&&(e=f('.dt-checkboxes-select-all[data-col="'+
a+'"] input[type="checkbox"]',d._oFixedColumns.dom.clone.right.header)));0===h?g=b=!1:h+k===b.length?(b=!0,g=!1):g=b=!0;var q=e.data("is-changed"),l=e.prop("checked"),m=e.prop("indeterminate");if(q||l!==b||m!==g)e.data("is-changed",!1),e.prop({checked:b,indeterminate:g}),f.isFunction(d.aoColumns[a].checkboxes.selectAllCallback)&&d.aoColumns[a].checkboxes.selectAllCallback(e.closest("th").get(0),b,g)}},showInfoSelected:function(){var a=this.s.dt,c=this.s.ctx;if(c.aanFeatures.i){var b=this.getSelectRowColIndex();
if(null!==b){var d=0,g;for(g in c.checkboxes.s.data[b])c.checkboxes.s.data[b].hasOwnProperty(g)&&d++;f.each(c.aanFeatures.i,function(b,c){b=f(c);c=f('<span class="select-info"/>');var e=d;c.append(f('<span class="select-item"/>').append(a.i18n("select.rows",{_:"%d rows selected",0:"",1:"1 row selected"},e)));e=b.children("span.select-info");e.length&&e.remove();""!==c.text()&&b.append(c)})}}},isCellSelectable:function(a,c){return this.s.ctx.checkboxes.s.dataDisabled[a].hasOwnProperty(c)?!1:!0},getCellIndex:function(a){return this.s.dt.cell(a).index()},
getSelectRowColIndex:function(){for(var a=this.s.ctx,c=null,b=0;b<a.aoColumns.length;b++)if(a.aoColumns[b].checkboxes&&a.aoColumns[b].checkboxes.selectRow){c=b;break}return c},updateFixedColumn:function(a){var c=this.s.dt,b=this.s.ctx;if(b._oFixedColumns){var d=b.aoColumns.length-b._oFixedColumns.s.iRightColumns-1;(a<b._oFixedColumns.s.iLeftColumns||a>d)&&c.fixedColumns().update()}}};n.defaults={stateSave:!0,selectRow:!1,selectAll:!0,selectAllPages:!0,selectCallback:null,selectAllCallback:null,selectAllRender:'<input type="checkbox">'};
l=f.fn.dataTable.Api;l.register("checkboxes()",function(){return this});l.registerPlural("columns().checkboxes.select()","column().checkboxes.select()",function(a){"undefined"===typeof a&&(a=!0);return this.iterator("column-rows",function(c,b,d,g,e){if(c.aoColumns[b].checkboxes){var h=[];f.each(e,function(a,c){h.push({row:c,column:b})});d=this.cells(h);d=c.rowId?this.rows(d.nodes()).ids():d.data();var k=[];h=[];f.each(d,function(a,d){c.checkboxes.isCellSelectable(b,d)&&(h.push({row:e[a],column:b}),
k.push(e[a]))});d=this.cells(h);c.checkboxes.updateData(d,b,a);c.checkboxes.updateCheckbox(d,b,a);c.aoColumns[b].checkboxes.selectRow&&c.checkboxes.updateSelect(k,a);c._oFixedColumns?setTimeout(function(){c.checkboxes.updateSelectAll(b)},0):c.checkboxes.updateSelectAll(b);c.checkboxes.updateFixedColumn(b)}},1)});l.registerPlural("cells().checkboxes.select()","cell().checkboxes.select()",function(a){"undefined"===typeof a&&(a=!0);return this.iterator("cell",function(c,b,d){if(c.aoColumns[d].checkboxes){var f=
this.cells([{row:b,column:d}]),e=c.rowId?this.cell({row:b,column:d}).row().id():this.cell({row:b,column:d}).data();c.checkboxes.isCellSelectable(d,e)&&(c.checkboxes.updateData(f,d,a),c.checkboxes.updateCheckbox(f,d,a),c.aoColumns[d].checkboxes.selectRow&&c.checkboxes.updateSelect(b,a),c._oFixedColumns?setTimeout(function(){c.checkboxes.updateSelectAll(d)},0):c.checkboxes.updateSelectAll(d),c.checkboxes.updateFixedColumn(d))}},1)});l.registerPlural("cells().checkboxes.enable()","cell().checkboxes.enable()",
function(a){"undefined"===typeof a&&(a=!0);return this.iterator("cell",function(c,b,d){if(c.aoColumns[d].checkboxes){var g=this.cell({row:b,column:d}),e=c.rowId?g.row().id():g.data(),h=g.data(),k=this.row(g.node()).data();a?delete c.checkboxes.s.dataDisabled[d][e]:c.checkboxes.s.dataDisabled[d][e]={cell:h,row:k};(g=g.node())&&f("input.dt-checkboxes",g).prop("disabled",!a);c.aoColumns[d].checkboxes.selectRow&&c.checkboxes.s.data[d].hasOwnProperty(e)&&c.checkboxes.updateSelect(b,a)}},1)});l.registerPlural("cells().checkboxes.disable()",
"cell().checkboxes.disable()",function(a){"undefined"===typeof a&&(a=!0);return this.checkboxes.enable(!a)});l.registerPlural("columns().checkboxes.deselect()","column().checkboxes.deselect()",function(a){"undefined"===typeof a&&(a=!0);return this.checkboxes.select(!a)});l.registerPlural("cells().checkboxes.deselect()","cell().checkboxes.deselect()",function(a){"undefined"===typeof a&&(a=!0);return this.checkboxes.select(!a)});l.registerPlural("columns().checkboxes.deselectAll()","column().checkboxes.deselectAll()",
function(){return this.iterator("column",function(a,c){a.aoColumns[c].checkboxes&&(a.checkboxes.s.data[c]={},this.column(c).checkboxes.select(!1))},1)});l.registerPlural("columns().checkboxes.selected()","column().checkboxes.selected()",function(){return this.iterator("column-rows",function(a,c,b,d,g){if(a.aoColumns[c].checkboxes){var e=[];if(a.oFeatures.bServerSide)f.each(a.checkboxes.s.data[c],function(b,d){a.checkboxes.isCellSelectable(c,b)&&e.push(d.cell)});else{var h=[];f.each(g,function(a,b){h.push({row:b,
column:c})});b=this.cells(h);d=a.rowId?this.rows(b.nodes()).ids():b.data();var k=b.data();f.each(d,function(b,d){a.checkboxes.s.data[c].hasOwnProperty(d)&&a.checkboxes.isCellSelectable(c,d)&&e.push(k[b])})}return e}return[]},1)});l.registerPlural("columns().checkboxes.ids()","column().checkboxes.ids()",function(){return this.iterator("column-rows",function(a,c,b,d,g){if(a.aoColumns[c].checkboxes){var e=[];if(a.oFeatures.bServerSide)f.each(a.checkboxes.s.data[c],function(b,d){a.checkboxes.isCellSelectable(c,
b)&&e.push(b)});else{var h=[];f.each(g,function(a,b){h.push({row:b,column:c})});b=this.cells(h);b=this.rows(b.nodes()).ids();f.each(b,function(b,d){a.checkboxes.s.data[c].hasOwnProperty(d)&&a.checkboxes.isCellSelectable(c,d)&&e.push(d)})}return e}return[]},1)});l.registerPlural("columns().checkboxes.data()","column().checkboxes.data()",function(){return this.iterator("column-rows",function(a,c,b,d,g){if(a.aoColumns[c].checkboxes){var e=[];if(a.oFeatures.bServerSide)f.each(a.checkboxes.s.data[c],function(b,
d){a.checkboxes.isCellSelectable(c,b)&&e.push(d.row)});else{var h=[];f.each(g,function(a,b){h.push({row:b,column:c})});b=this.cells(h);d=a.rowId?this.rows(b.nodes()).ids():b.data();b.data();var k=this.rows(b.nodes()).data();f.each(d,function(b,d){a.checkboxes.s.data[c].hasOwnProperty(d)&&a.checkboxes.isCellSelectable(c,d)&&e.push(k[b])})}return e}return[]},1)});n.version="1.2.11";f.fn.DataTable.Checkboxes=n;f.fn.dataTable.Checkboxes=n;f(m).on("preInit.dt.dtCheckboxes",function(a,c){"dt"===a.namespace&&
new n(c)});return n});
